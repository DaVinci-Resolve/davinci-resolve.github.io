"use strict";bmdApp.config(["$stateProvider","$urlRouterProvider","$provide",function(e,n,t){t.decorator("$location",["$delegate","bmdLocation",function(e,n){return n(e,void 0)}])}]),bmdControllers.controller("V5Ctrl",["$rootScope","$scope","$window","$location","SupportService",function(e,n,t,r,o){n.selectAndDownloadRelease=function(t){return o.selectAndDownloadRelease(e,n,t)},n.downloadRelease=function(t,r){return o.downloadRelease(e,n,t,r)};var i=!1;angular.element(document).ready(function(){var t=r.search().download||null;if(!i&&t){i=!0,r.search("download",null);var u;switch(t){case"studio":u="/products/davinciresolve/modal/download-one-col-16-studio";break;default:case"free":u="/products/davinciresolve/modal/download-one-col-16"}o.selectAndDownloadRelease(e,n,u),n.$apply()}})}]),bmdControllers.controller("TrainingResourcesCtrl",["$rootScope","$scope","i18n","$q","$window","$location","$sce","TrainingVideoModalService","SupportService",function(e,n,t,r,o,i,u,c,a){function s(e){if(306952907==e)return 0;if(306740099==e){if($(window).width()>=809)return 0;if($(window).width()<=580)return 1;if($(window).width()<809)return 0}else if(306955099==e){if($(window).width()>=809)return 0;if($(window).width()<=580)return 2;if($(window).width()<809)return 1}else if(307175938==e){if($(window).width()>=809)return 0;if($(window).width()<=580)return 3;if($(window).width()<809)return 1}else if(306960041==e){if($(window).width()>=809)return 1;if($(window).width()<=580)return 4;if($(window).width()<809)return 2}else if(306748314==e){if($(window).width()>=809)return 1;if($(window).width()<=580)return 5;if($(window).width()<809)return 2}else if(306927660==e){if($(window).width()>=809)return 1;if($(window).width()<=580)return 6;if($(window).width()<809)return 3}else if(307178223==e){if($(window).width()>=809)return 1;if($(window).width()<=580)return 7;if($(window).width()<809)return 3}else{if(306958967!=e)return 0;if($(window).width()>=809)return 2;if($(window).width()<=580)return 8;if($(window).width()<809)return 4}}var d,l={opened:!1,current:null};n.openTrainingModal=function(e,t,r,i){null==l.current&&(n.videoMapping=o.__bmd.attrs.videoMapping||null,n.videoName=r||null,e+="?videoName="+r,i=i||n,l.opened=!0,l.current=c.create(e,t,i),l.current.open(),$("html").css("overflow","hidden"),$("html").css("position","fixed"),$("html").css("width","-webkit-fill-available"))},n.closeTrainingModal=function(){null!=l.current&&(l.opened=!1,l.current.close(),l.current=null),$("html").css("overflow",""),$("html").css("position",""),$("html").css("width","");var e=t.getUrlPrefix()+"/training";i.url(e)},n.selectAndDownloadRelease=function(t){return a.selectAndDownloadRelease(e,n,t)},n.downloadRelease=function(t,r){return a.downloadRelease(e,n,t,r)},n.getVimeoUrlForVideo=function(e){if(!d){var n=$(".training-video-modal .videos");n.trigger("to.owl.carousel",[s(e),0])}return u.trustAsResourceUrl("//player.vimeo.com/video/"+e)},n.loadNewTrainingVideo=function(e){var r=t.getUrlPrefix()+"/training?launch-video-modal="+e;i.url(r),i.replace(),n.videoName=e,d=!0},n.getVideoName=function(){var e=i.search()["launch-video-modal"]||null;return e};var f=i.search()["launch-video-modal"]||null;if(f){var y=t.getUrlPrefix()+"/products/davinciresolve/modal/training-video";n.openTrainingModal(y,"modal",f)}}]),bmdControllers.controller("TrainerCtrl",["$scope","i18n","$q","$window","TrainingService",function(e,n,t,r,o){function i(){e.query.country=c,e.query.state="",d(),s()}e.xlate=function(e){var n=r.__bmd&&r.__bmd.catalogues||{};for(var t in n){var o=n[t]||{},i=o[e];if(void 0!==i)return i}return e},e.countries=[],e.states=[],e.query={country:"",state:"",type:""};var u={},c="us",a=function(){var n=u[e.query.country];e.states=n&&n.states||[]},s=function(){""!=e.query.type&&o.fetchTrainers(e.query).then(function(n){e.trainers=n},function(e){console.error("Failed to fetch trainers",e)})},d=function(){var n=e.query.type;o.getTrainerCountryList(n).then(function(n){u=n;var t=[];for(var r in n)t.push({code:r,name:n[r].name});e.countries=t,null==n[e.query.country]&&(e.query.country=""),a(),s()})};e.onCountryChange=function(){e.query.state="",s(),a()},e.onStateChange=function(){e.query.state=e.query.state||"",s()},e.onTrainingTypeChange=function(){e.query.type=e.query.type||"","online"==e.query.type?e.query.country="":(""==e.query.country&&(e.query.country=c),d()),s()},e.getTrainingSearchClasses=function(){var n={},t="search-"+e.query.type;return n[t]=!0,n},e.getTrainingResultsClasses=function(){var n={},t="results-"+e.query.type;return n[t]=!0,n},e.getQueryType=function(){return e.query.type},e.onClearResults=function(){i()},e.isCountryDisabled=function(){return""==e.query.type||"online"==e.query.type},e.isStateDisabled=function(){return e.isCountryDisabled()||e.states.length<1},e.areResultsShown=function(){return""!=e.query.type},c=n.getIsoCountry()||"us",i()}]),bmdControllers.controller("CertificationCtrl",["$scope","i18n","$q","TrainingService",function(e,n,t,r){function o(){e.query.country=u,e.query.state="",s(),a()}e.countries=[],e.states=[],e.query={country:"",state:"",type:""};var i={},u="us",c=function(){var n=i[e.query.country];e.states=n&&n.states||[]},a=function(){""!=e.query.type&&r.fetchCertifiedUsers(e.query).then(function(n){e.users=n},function(e){console.error("Failed to fetch certified users",e)})},s=function(){var n=e.query.type;r.getUserCountryList(n).then(function(n){i=n;var t=[];for(var r in n)t.push({code:r,name:n[r].name});e.countries=t,null==n[e.query.country]&&(e.query.country=""),c(),a()})};e.onCountryChange=function(){e.query.state="",a(),c()},e.onStateChange=function(){e.query.state=e.query.state||"",a()},e.onCertificationChange=function(){e.query.type=e.query.type||"",""==e.query.country&&(e.query.country=u),s(),a()},e.getCertifiedSearchClasses=function(){var n={},t="search-"+e.query.type;return n[t]=!0,n},e.getCertifiedResultsClasses=function(){var n={},t="results-"+e.query.type;return n[t]=!0,n},e.onClearResults=function(){o()},e.isCountryDisabled=function(){return""==e.query.type},e.isStateDisabled=function(){return e.isCountryDisabled()||e.states.length<1},e.areResultsShown=function(){return""!=e.query.type},u=n.getIsoCountry()||"us",o()}]),bmdServices.factory("TrainingService",["i18n","$http","$q",function(e,n,t){var r={},o={getTrainerCountryList:function(e){var n="/api/training/%s/davinciresolve/trainers/country-list/"+e,t="trainer:countries:"+e;return o.cachedApiModelFetch(t,n)},fetchTrainers:function(e){var n="trainers:"+JSON.stringify(e),r="/api/training/%s/davinciresolve/trainers/"+e.type,i={country:e.country||"",state:e.state||""},u=t.defer();return o.cachedApiModelFetch(n,r,i).then(function(e){e=e||[];for(var n=0;n<e.length;++n){var t=e[n];t.website&&!t.website.match(/^https?:\/\//)&&(t.website="http://"+t.website),t.email&&!t.email.match(/^https?:\/\//)&&t.email.match(/@/)?t.emailLink="mailto:"+t.email:t.emailLink=t.email}u.resolve(e)}),u.promise},getUserCountryList:function(e){var n="/api/training/%s/davinciresolve/certified-users/country-list/"+e,t="users:countries:"+e;return o.cachedApiModelFetch(t,n)},fetchCertifiedUsers:function(e){var n="users:"+JSON.stringify(e),r="/api/training/%s/davinciresolve/certified-users/"+e.type,i={country:e.country||"",state:e.state||""},u=t.defer();return o.cachedApiModelFetch(n,r,i).then(function(e){e=e||[];for(var n=0;n<e.length;++n){var t=e[n];t.emailLink="mailto:"+t.email}u.resolve(e)}),u.promise},cachedApiModelFetch:function(e,n,i){if(void 0===r[e]){var u=t.defer();r[e]=u.promise,o._simpleApiModelFetch(n,i).then(function(e){u.resolve(e)},function(n){u.reject(n),delete r[e]})}return r[e]},_simpleApiModelFetch:function(r,o){var i=void 0===o?void 0:{params:o},u=t.defer(),c=r.replace(/%s/,e.getCountry());return n.get(c,i).then(function(e){u.resolve(e.data||{})},function(e){console.error("Failed to fetch",c,":",e),u.reject(e)}),u.promise}};return o}]),bmdServices.factory("TrainingVideoModalService",["$compile","$window",function(e,n){var t={create:function(n,t,r,o,i){o=o||"body",i=i||{};var u=r.$new(!1);for(var c in i)u[c]=i[c];var a="modal-"+Math.random().toString(16).substring(8),s=document.createElement("div");s.setAttribute("id",a),s.setAttribute("ng-include","'"+n+"'"),s.setAttribute("class",t);var d=e(s),l=d(u);return{scope:u,container:l,open:function(){$(o).append(l)},close:function(){u.$destroy();var e="#"+a;$(e).remove()}}}};return t}]),bmdControllers.controller("MiniStoreCountrySelectorCtrl",["$scope","$window",function(e,n){e.selected={},e.dropdownIsOpened=!1;var t=document.querySelector(".mini-store-blackout .modal .menu .current");t.focus(),e.isDropdownOpened=function(){return e.dropdownIsOpened},e.onDropdownClick=function(){e.dropdownIsOpened=!e.dropdownIsOpened},e.onDropdownKeypress=function(n){var t=["Enter"," "];t.indexOf(n.key)!==-1&&(e.dropdownIsOpened=!e.dropdownIsOpened)},e.onCloseModalKeypress=function(e){var n=["Enter"," "];n.indexOf(e.key)!==-1&&this.closeSimpleModal()},e.closeDropdown=function(){e.dropdownIsOpened=!1},e.getCheckoutUrl=function(e,n){return"/edelivery/buy/"+n+"/"+e},e.onCountryConfirmed=function(t){var r=e.selected.code!==e.selected.storeCountry?e.selected.code:e.selected.storeCountry,o="/"+e.selected.storeCountry+e.getCheckoutUrl(r,t);n.location.href=o};var r=e.$on("country-selected",function(n,t){e.selected=t});e.$on("$destroy",function(){null!=r&&(r(),r=null)})}]),bmdApp.directive("miniStoreCountryOption",[function(){return{restrict:"A",scope:!0,replace:!1,link:function(e,n,t){e.countryCode=t.miniStoreCountryOption,e.countryName=t.countryName,e.countryFlag=t.flag,e.storeCountry=t.storeCountry,e.emitSelectedEvent=function(){e.$emit("country-selected",{code:e.countryCode,name:e.countryName,flag:e.countryFlag,storeCountry:e.storeCountry})},e.onCountryClicked=function(){e.emitSelectedEvent()},e.onCountryKeyup=function(n){var t=["Escape"];t.indexOf(n.key)!==-1&&this.closeDropdown();var r=["Enter"," "];r.indexOf(n.key)!==-1&&(e.emitSelectedEvent(),this.closeDropdown())},"selected"===t.initialState&&e.emitSelectedEvent()}}}]),bmdServices.factory("MiniStoreCountrySelectorService",[function(){var e={getModel:function(){return window.__bmd.countryInfo||{}},getCountryName:function(n){var t=e.getModel();return t.display}};return e}]),bmdApp.filter("trusted",["$sce",function(e){return function(n){return null==n||""==n.length?"":e.trustAsHtml(n)}}]);